function setupOmnitureTracking(omnitureAccount,omniturePrefix,omnitureCategory,sectionName,pageType,mode,siteName,isCP24Tracking,isDebugMode,isErrorPage,globalSuite){var s_account=omnitureAccount;Tracking.setGlobalSuite(globalSuite);var s=s_gi(s_account);var pathname=window.location.pathname;var pagename=omniturePrefix;var subsections=new Array(null,null,null);var isMobileMode=false;if("mobile"==mode){isMobileMode=true;pagename+=":"+mode;}if(isCP24Tracking=="true"){if(sectionName.length>0&&pageType=="home"){pagename+=":"+sectionName;}Tracking.setValue(69,"CP24 Website");}else{pagename+=":"+siteName;Tracking.setValue(69,"CTVNews Website");}if(pathname.length>0&&pathname.indexOf("cmlink")==-1){if(isMobileMode){pathname=pathname.replace("mobile/","");}if(pathname.indexOf("search-results")>0){pathname="/search-results";}if(siteName.length>0){pathname=pathname.replace("/"+siteName.toLowerCase()+"/","/");}pathname=pathname.replace(/\//g,":");if(pathname.length==1){pathname="";}if(pageType==="home"){pagename+=pathname;pagename+=":"+pageType;}else{var index=pathname.lastIndexOf(":");if(index>0){pagename+=pathname.substr(0,index);if(pageType!=""&&pagename.substr(-1)!=":"){pagename+=":"+pageType;}pagename+=pathname.substr(index);}else{if(pageType.length>0){pagename+=":"+pageType;}pagename+=pathname;}}var id_match=/[0-9]*\.[0-9]*/;if(isCP24Tracking!="true"){setCTVNewsSubSections(pagename,id_match,siteName,omniturePrefix,mode,subsections);}else{setCP24SubSections(pathname,id_match,pageType,subsections);}Tracking.setSubSections(subsections[0],subsections[1],subsections[2]);}if(isCP24Tracking!="true"){sectionName=getCTVNewsSectionName(sectionName,isMobileMode);}else{sectionName=getCP24SectionName(pageType,subsections[0],sectionName,isMobileMode);}Tracking.setSiteAccount(omnitureAccount);Tracking.setSiteSection(sectionName);Tracking.setSiteId(siteName);Tracking.setPageName(pagename);if(isErrorPage){setPageType("errorPage");}if(isDebugMode){document.write("<div id='omnitureConfiguration' style='display: none;'>");document.write("<p class='setSiteAccount'>"+omnitureAccount+"</p>");document.write("<p class='setSiteId'>"+siteName+"</p>");document.write("<p class='setSiteSectionName'>"+sectionName+"</p>");document.write("<p class='setPageName'>"+pagename+"</p>");document.write("<p class='setSubSections'>"+subsections[0]+","+subsections[1]+","+subsections[2]+"</p>");document.write("</div>");document.write("<div id='omnitureTracking' style='display: none;'>");document.write("</div>");}}function setCP24SubSections(pathname,id_match,pageType,subsections){var path=pathname.split(":");var len=Math.min(subsections.length,path.length);var index=0;for(var i=0;i<len;i++){if(""!=path[i]&&!id_match.test(path[i])){subsections[index++]=path[i];}}if(index<3&&pageType.length>0){subsections[index]=pageType;}}function setCTVNewsSubSections(pagename,id_match,siteName,omniturePrefix,mode,subsections){var pathPageName=pagename.split(":");var subSectionsIndex=0;if("mobile"==mode){subSectionsIndex=1;subsections[0]=siteName;}for(i=0;i<pathPageName.length;i++){if(""!=pathPageName[i]&&!id_match.test(pathPageName[i])){if(omniturePrefix!=pathPageName[i]&&siteName!=pathPageName[i]&&mode!=pathPageName[i]){subsections[subSectionsIndex++]=pathPageName[i];}}}while(subsections.length>3){subsections.splice(1,1);}}function getCP24SectionName(pageType,subsection0,sectionName,isMobileMode){if(isMobileMode){sectionName=window.location.host;var subPath=window.location.pathname;if(subPath.indexOf("/mobile/")>-1){sectionName=sectionName+"/mobile";}}else{if(pageType!="home"&&subsection0){sectionName=subsection0;}}return sectionName;}function getCTVNewsSectionName(sectionName,isMobileMode){if(isMobileMode){return"m.ctvnews.ca";}return sectionName;}function trackContent(isDebugMode,contentTitle){if(contentTitle){if(isDebugMode){jQuery("#omnitureTracking").append("<p class='setContentTitle'>"+contentTitle+"</p>").append("<p class='tracking'>ContentTracking</p>");}else{Tracking.setContentTitle(contentTitle);Tracking.track();}}}function trackGallery(isDebugMode,imageTitle){var pathname=window.location.pathname;var index=pathname.lastIndexOf("/")+1;if(pathname.length>0&&index<pathname.length){var gallery=pathname.substr(index,pathname.length);if(isDebugMode){jQuery("#omnitureTracking").html("<p class='setGalleryName'>"+gallery+"</p>");}else{Tracking.setGalleryName(gallery);}}trackContent(isDebugMode,imageTitle);Tracking.trackPage();}function trackLightbox(isDebugMode,imageTitle){var oldPath=s.pageName;var newPath=oldPath.replace(":story:",":lightbox:");Tracking.setPageName(newPath);trackGallery(isDebugMode,imageTitle);}function trackPage(isDebugMode){if(isDebugMode){jQuery("#omnitureTracking").append("<p class='tracking'>PageTracking</p>");}else{Tracking.track();}}function trackSearchCTVNews(isDebugMode,term,count){if(isDebugMode){jQuery("#omnitureTracking").append("<p class='trackSearchQuery'>"+term+"</p>").append("<p class='trackSearchHits'>"+count+"</p>");}else{Tracking.trackSearch(term,count);Tracking.track();}}function setPageType(pageType){window.s.pageType=pageType;}